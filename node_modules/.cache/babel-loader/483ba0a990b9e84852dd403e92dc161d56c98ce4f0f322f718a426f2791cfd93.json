{"ast":null,"code":"import React,{createContext,useState,useEffect,useCallback}from'react';import{jsx as _jsx}from\"react/jsx-runtime\";export const AuthContext=/*#__PURE__*/createContext();export function AuthProvider(_ref){let{children}=_ref;const[isAuthenticated,setIsAuthenticated]=useState(!!localStorage.getItem('token'));const[user,setUser]=useState(null);// Refresh access token using refresh token cookie\nconst refreshAccessToken=useCallback(async()=>{try{const res=await fetch(\"\".concat(process.env.REACT_APP_API_URL||'http://localhost:5000',\"/api/auth/refresh\"),{method:'POST',credentials:'include'});const data=await res.json();if(res.ok&&data.token){localStorage.setItem('token',data.token);setIsAuthenticated(true);return data.token;}else{logout();return null;}}catch(_unused){logout();return null;}},[]);useEffect(()=>{if(!localStorage.getItem('token')){// Try to refresh on mount if no token\nrefreshAccessToken();}if(isAuthenticated&&!user){fetch(\"\".concat(process.env.REACT_APP_API_URL||'http://localhost:5000',\"/api/profile\"),{headers:{'Authorization':\"Bearer \".concat(localStorage.getItem('token'))},credentials:'include'// for HTTP-only cookies if backend supports\n}).then(res=>res.json()).then(data=>setUser(data)).catch(()=>setUser(null));}},[isAuthenticated,user,refreshAccessToken]);const login=(profile,token)=>{setIsAuthenticated(true);setUser(profile);if(token){localStorage.setItem('token',token);// Optionally, set cookie via backend Set-Cookie header\n}};const logout=()=>{localStorage.removeItem('token');setIsAuthenticated(false);setUser(null);// Optionally, clear cookie via backend endpoint\nfetch(\"\".concat(process.env.REACT_APP_API_URL||'http://localhost:5000',\"/api/auth/logout\"),{method:'POST',credentials:'include'}).catch(()=>{});};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{isAuthenticated,user,login,logout,refreshAccessToken},children:children});}","map":{"version":3,"names":["React","createContext","useState","useEffect","useCallback","jsx","_jsx","AuthContext","AuthProvider","_ref","children","isAuthenticated","setIsAuthenticated","localStorage","getItem","user","setUser","refreshAccessToken","res","fetch","concat","process","env","REACT_APP_API_URL","method","credentials","data","json","ok","token","setItem","logout","_unused","headers","then","catch","login","profile","removeItem","Provider","value"],"sources":["C:/Users/Bitrus.ed/Desktop/movie-recommendation-app/frontend/src/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useEffect, useCallback } from 'react';\r\n\r\nexport const AuthContext = createContext();\r\n\r\nexport function AuthProvider({ children }) {\r\n  const [isAuthenticated, setIsAuthenticated] = useState(!!localStorage.getItem('token'));\r\n  const [user, setUser] = useState(null);\r\n\r\n  // Refresh access token using refresh token cookie\r\n  const refreshAccessToken = useCallback(async () => {\r\n    try {\r\n      const res = await fetch(`${process.env.REACT_APP_API_URL || 'http://localhost:5000'}/api/auth/refresh`, {\r\n        method: 'POST',\r\n        credentials: 'include',\r\n      });\r\n      const data = await res.json();\r\n      if (res.ok && data.token) {\r\n        localStorage.setItem('token', data.token);\r\n        setIsAuthenticated(true);\r\n        return data.token;\r\n      } else {\r\n        logout();\r\n        return null;\r\n      }\r\n    } catch {\r\n      logout();\r\n      return null;\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!localStorage.getItem('token')) {\r\n      // Try to refresh on mount if no token\r\n      refreshAccessToken();\r\n    }\r\n    if (isAuthenticated && !user) {\r\n      fetch(`${process.env.REACT_APP_API_URL || 'http://localhost:5000'}/api/profile`, {\r\n        headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` },\r\n        credentials: 'include', // for HTTP-only cookies if backend supports\r\n      })\r\n        .then(res => res.json())\r\n        .then(data => setUser(data))\r\n        .catch(() => setUser(null));\r\n    }\r\n  }, [isAuthenticated, user, refreshAccessToken]);\r\n\r\n  const login = (profile, token) => {\r\n    setIsAuthenticated(true);\r\n    setUser(profile);\r\n    if (token) {\r\n      localStorage.setItem('token', token);\r\n      // Optionally, set cookie via backend Set-Cookie header\r\n    }\r\n  };\r\n\r\n  const logout = () => {\r\n    localStorage.removeItem('token');\r\n    setIsAuthenticated(false);\r\n    setUser(null);\r\n    // Optionally, clear cookie via backend endpoint\r\n    fetch(`${process.env.REACT_APP_API_URL || 'http://localhost:5000'}/api/auth/logout`, {\r\n      method: 'POST',\r\n      credentials: 'include',\r\n    }).catch(() => {});\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ isAuthenticated, user, login, logout, refreshAccessToken }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}